<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>promise | å‰ç«¯çŸ¥è¯†ä»“</title>
    <meta name="description" content="èŠ±é‡Œèƒ¡å“¨">
    <link rel="icon" href="/vuepress-blog/img/icon.png">
  <link rel="stylesheet" href="/vuepress-blog/css/style.css">
  <script charset="utf-8" src="/vuepress-blog/js/main.js"></script>
    
    <link rel="preload" href="/vuepress-blog/assets/css/0.styles.6144796f.css" as="style"><link rel="preload" href="/vuepress-blog/assets/js/app.428408aa.js" as="script"><link rel="preload" href="/vuepress-blog/assets/js/2.5f74fd52.js" as="script"><link rel="preload" href="/vuepress-blog/assets/js/16.76c0197a.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/js/10.6ee50dc5.js"><link rel="prefetch" href="/vuepress-blog/assets/js/11.5721ba42.js"><link rel="prefetch" href="/vuepress-blog/assets/js/12.93bd139b.js"><link rel="prefetch" href="/vuepress-blog/assets/js/13.2e08c5b0.js"><link rel="prefetch" href="/vuepress-blog/assets/js/14.6b8e2fe4.js"><link rel="prefetch" href="/vuepress-blog/assets/js/15.db00b867.js"><link rel="prefetch" href="/vuepress-blog/assets/js/17.064c03a0.js"><link rel="prefetch" href="/vuepress-blog/assets/js/18.169c4467.js"><link rel="prefetch" href="/vuepress-blog/assets/js/19.54d294bf.js"><link rel="prefetch" href="/vuepress-blog/assets/js/20.61749c30.js"><link rel="prefetch" href="/vuepress-blog/assets/js/21.02d76a00.js"><link rel="prefetch" href="/vuepress-blog/assets/js/22.634d0561.js"><link rel="prefetch" href="/vuepress-blog/assets/js/23.ed215409.js"><link rel="prefetch" href="/vuepress-blog/assets/js/24.d878f036.js"><link rel="prefetch" href="/vuepress-blog/assets/js/25.8ff69a7f.js"><link rel="prefetch" href="/vuepress-blog/assets/js/26.1340f8b2.js"><link rel="prefetch" href="/vuepress-blog/assets/js/27.e9ddf183.js"><link rel="prefetch" href="/vuepress-blog/assets/js/28.fb230470.js"><link rel="prefetch" href="/vuepress-blog/assets/js/29.be5aa049.js"><link rel="prefetch" href="/vuepress-blog/assets/js/3.7c5347fc.js"><link rel="prefetch" href="/vuepress-blog/assets/js/30.cf1b0089.js"><link rel="prefetch" href="/vuepress-blog/assets/js/31.e22db0f3.js"><link rel="prefetch" href="/vuepress-blog/assets/js/32.a38dbfd3.js"><link rel="prefetch" href="/vuepress-blog/assets/js/33.b3374b6c.js"><link rel="prefetch" href="/vuepress-blog/assets/js/34.21ca8a9f.js"><link rel="prefetch" href="/vuepress-blog/assets/js/35.887a951e.js"><link rel="prefetch" href="/vuepress-blog/assets/js/4.37fd6b53.js"><link rel="prefetch" href="/vuepress-blog/assets/js/5.62542faa.js"><link rel="prefetch" href="/vuepress-blog/assets/js/6.dd8bd59c.js"><link rel="prefetch" href="/vuepress-blog/assets/js/7.5cd89385.js"><link rel="prefetch" href="/vuepress-blog/assets/js/8.3b227e71.js"><link rel="prefetch" href="/vuepress-blog/assets/js/9.744c1a1c.js">
    <link rel="stylesheet" href="/vuepress-blog/assets/css/0.styles.6144796f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/vuepress-blog/" class="home-link router-link-active"><!----> <span class="site-name">å‰ç«¯çŸ¥è¯†ä»“</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/vuepress-blog/guide/" class="nav-link">æ‡µé€¼æŒ‡å—</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="å­¦ä¹ ç¬”è®°" class="dropdown-title"><span class="title">å­¦ä¹ ç¬”è®°</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepress-blog/baodian/zero/" class="nav-link">åŸºç¡€çŸ¥è¯†</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/baodian/high/" class="nav-link">å¸¸ç”¨å‘½ä»¤</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="å‰ç«¯ç®—æ³•" class="dropdown-title"><span class="title">å‰ç«¯ç®—æ³•</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepress-blog/suanfa/one/" class="nav-link">âœï¸leetcodeé¢˜è§£</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/suanfa/two/" class="nav-link">ğŸ’¡ç®—æ³•å½’çº³</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="é¢è¯•çŸ¥è¯†" class="dropdown-title"><span class="title">é¢è¯•çŸ¥è¯†</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepress-blog/interview/one/" class="nav-link router-link-active">jsåŸºç¡€çŸ¥è¯†</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/interview/two/" class="nav-link">vue</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="æœåŠ¡ç›¸å…³" class="dropdown-title"><span class="title">æœåŠ¡ç›¸å…³</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>åœ¨çº¿ç¼–è¾‘</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://tinypng.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  å›¾ç‰‡å‹ç¼©
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li><li class="dropdown-item"><h4>åœ¨çº¿æœåŠ¡</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://www.aliyun.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  é˜¿é‡Œäº‘
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://cloud.tencent.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  è…¾è®¯äº‘
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li><li class="dropdown-item"><h4>åšå®¢æŒ‡å—</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://juejin.im/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  æ˜é‡‘
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://blog.csdn.net/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CSDN
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li></ul></div></div> <a href="https://github.com/chunyanhuang/vuepress-blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/vuepress-blog/guide/" class="nav-link">æ‡µé€¼æŒ‡å—</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="å­¦ä¹ ç¬”è®°" class="dropdown-title"><span class="title">å­¦ä¹ ç¬”è®°</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepress-blog/baodian/zero/" class="nav-link">åŸºç¡€çŸ¥è¯†</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/baodian/high/" class="nav-link">å¸¸ç”¨å‘½ä»¤</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="å‰ç«¯ç®—æ³•" class="dropdown-title"><span class="title">å‰ç«¯ç®—æ³•</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepress-blog/suanfa/one/" class="nav-link">âœï¸leetcodeé¢˜è§£</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/suanfa/two/" class="nav-link">ğŸ’¡ç®—æ³•å½’çº³</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="é¢è¯•çŸ¥è¯†" class="dropdown-title"><span class="title">é¢è¯•çŸ¥è¯†</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepress-blog/interview/one/" class="nav-link router-link-active">jsåŸºç¡€çŸ¥è¯†</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/interview/two/" class="nav-link">vue</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="æœåŠ¡ç›¸å…³" class="dropdown-title"><span class="title">æœåŠ¡ç›¸å…³</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>åœ¨çº¿ç¼–è¾‘</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://tinypng.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  å›¾ç‰‡å‹ç¼©
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li><li class="dropdown-item"><h4>åœ¨çº¿æœåŠ¡</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://www.aliyun.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  é˜¿é‡Œäº‘
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://cloud.tencent.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  è…¾è®¯äº‘
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li><li class="dropdown-item"><h4>åšå®¢æŒ‡å—</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://juejin.im/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  æ˜é‡‘
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://blog.csdn.net/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CSDN
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li></ul></div></div> <a href="https://github.com/chunyanhuang/vuepress-blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>jsåŸºç¡€çŸ¥è¯†</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vuepress-blog/interview/one/notes/æ•°æ®ç±»å‹.html" class="sidebar-link">æ•°æ®ç±»å‹</a></li><li><a href="/vuepress-blog/interview/one/notes/æ•°ç»„.html" class="sidebar-link">æ•°ç»„</a></li><li><a href="/vuepress-blog/interview/one/notes/ä½œç”¨åŸŸ.html" class="sidebar-link">ä½œç”¨åŸŸ</a></li><li><a href="/vuepress-blog/interview/one/notes/é—­åŒ….html" class="sidebar-link">é—­åŒ…</a></li><li><a href="/vuepress-blog/interview/one/notes/åŸå‹.html" class="sidebar-link">åŸå‹</a></li><li><a href="/vuepress-blog/interview/one/notes/promise.html" class="active sidebar-link">promise</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h3 id="promise"><a href="#promise" aria-hidden="true" class="header-anchor">#</a> promise</h3> <p><a href="#pp">promise</a> <a href="#ge">Generator,async</a></p> <p><span id="pp">##### promise</span><br> <strong>å®šä¹‰ï¼š</strong><br>
æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œç”¨æ¥<strong>ä¼ é€’å¼‚æ­¥æ“ä½œçš„æ¶ˆæ¯</strong>ï¼Œé¿å…äº†å±‚å±‚åµŒå¥—çš„å›è°ƒå‡½æ•°ã€‚<br> <strong>å‘å±•ï¼š</strong><br>
ES6è¯ç”Ÿä»¥å‰ï¼Œå¼‚æ­¥ç¼–ç¨‹çš„æ–¹æ³•ï¼Œå¤§æ¦‚æœ‰å¦‚ä¸‹å››ç§ï¼š<strong>å›è°ƒå‡½æ•°ã€äº‹ä»¶ç›‘å¬ã€å‘å¸ƒ/è®¢é˜…ã€Promiseå¯¹è±¡</strong>ï¼›ES6ä¸­ï¼Œå¼•å…¥äº†<strong>Generatorå‡½æ•°</strong>ï¼›ES7ä¸­ï¼Œ<strong>async</strong>æ›´æ˜¯å°†å¼‚æ­¥ç¼–ç¨‹å¸¦å…¥äº†ä¸€ä¸ªå…¨æ–°çš„é˜¶æ®µã€‚<br> <strong>è§£å†³çš„é—®é¢˜ï¼š</strong><br>
å›è°ƒåœ°ç‹±ï¼Œå³å¼‚æ­¥å›è°ƒ å¤šå±‚åµŒå¥—å½¢æˆï¼›ä¸æ˜“ç»´æŠ¤ã€‚ï¼ˆåµŒå¥—æ˜¯å› ä¸ºåé¢çš„å¼‚æ­¥æ“ä½œä¾èµ–å‰é¢çš„ç»“æœï¼‰ã€‚<br> <strong>promiseçš„ä¸‰ç§çŠ¶æ€ï¼š</strong></p> <ul><li>åˆå§‹åŒ–ï¼ŒçŠ¶æ€ï¼špending</li> <li>å½“è°ƒç”¨resolve(æˆåŠŸ)ï¼ŒçŠ¶æ€ï¼špending=&gt;fulfilled</li> <li>å½“è°ƒç”¨reject (å¤±è´¥), çŠ¶æ€ï¼špending=&gt;rejected</li> <li>åªè¦è¿™ä¸¤ç§æƒ…å†µå‘ç”Ÿï¼ŒçŠ¶æ€å°±å‡å›ºäº†ï¼Œä¸ä¼šå†æ”¹å˜ï¼Œç§°ä¸º ( resolved ) å·²å®šå‹ã€‚æ­¤æ—¶å†å¯¹promiseå¯¹è±¡æ·»åŠ å›è°ƒå‡½æ•°ï¼Œä¹Ÿä¼šç«‹å³å¾—åˆ°è¿™ä¸ªç»“æœã€‚</li></ul> <p><strong>promiseçš„ä½¿ç”¨ï¼š</strong></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// æ„é€ å‡½æ•°`Promise`å¿…é¡»æ¥å—ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼›`resolve`å’Œ`reject`ä¸¤ä¸ªå‚æ•°ï¼Œå®ƒä»¬æ˜¯ä¸¤ä¸ªå‡½æ•°ã€‚</span>
<span class="token keyword">var</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">// è¿™ä¸ªå‡½æ•°å†…éƒ¨å°±æ˜¯æ¥å†™å¼‚æ­¥æ“ä½œçš„</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> flag <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'æˆåŠŸ'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
      <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">2000</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// é€šè¿‡Promiseçš„å®ä¾‹å¯¹è±¡.thençš„æ–¹æ³•æ¥æŒ‡å®šæˆåŠŸå’Œå¤±è´¥çš„å›è°ƒ,thenæ–¹æ³•ç¬¬ä¸€ä¸ªå‚æ•°ï¼šæˆåŠŸçš„å‡½æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°å°±æ˜¯å¤±è´¥çš„å›è°ƒå‡½æ•°</span>
p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p><strong>å¦‚ä½•è§£å†³å›è°ƒåœ°ç‹±é—®é¢˜ï¼š</strong></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">queryData</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
          <span class="token comment">// 0åˆå§‹åŒ–è¯·æ±‚ï¼1å‘é€è¯·æ±‚ï¼2æ¥æ”¶æ•°æ®ï¼3è§£ææ•°æ®ï¼4å®Œæˆ ã€‚</span>
          <span class="token keyword">if</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">!=</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
          <span class="token keyword">if</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">==</span> <span class="token number">4</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// å¤„ç†æ­£å¸¸çš„æƒ…å†µ</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
            <span class="token comment">// å¤„ç†å¼‚å¸¸æƒ…å†µ</span>
            <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'æœåŠ¡å™¨é”™è¯¯'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'get'</span><span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">;</span>
        xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> p<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 <span class="token comment">// </span>
 <span class="token function">queryData</span><span class="token punctuation">(</span><span class="token string">'http://localhost:3000/data'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">queryData</span><span class="token punctuation">(</span><span class="token string">'http://localhost:3000/data1'</span><span class="token punctuation">)</span>  
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">queryData</span><span class="token punctuation">(</span><span class="token string">'http://localhost:3000/data2'</span><span class="token punctuation">)</span>  
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// åœ¨ç¬¬ä¸€ä¸ªthençš„æˆåŠŸçš„å›è°ƒå‡½æ•°é‡Œé¢ï¼Œreturnå›ä¸€ä¸ªæ–°çš„promiseå®ä¾‹å¯¹è±¡ï¼Œç„¶åæˆ‘ä»¬å°±å¯ä»¥åœ¨.thençš„åé¢ç»§ç»­è°ƒç”¨.thenä»è€Œæ„æˆé“¾å¼ç¼–ç¨‹</span>
<span class="token comment">// å¦‚æœ.thené‡Œé¢é€šè¿‡returnè¿”å›æ™®é€šå€¼ï¼Œé‚£ä¹ˆè¿˜æ˜¯å¯ä»¥è°ƒç”¨.then,å› ä¸ºä¸Šä¸€ä¸ªthené»˜è®¤åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„promise</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p><strong>promiseå¸¸ç”¨API:</strong></p> <ul><li><strong>p.then()</strong> å¼‚æ­¥å¤„ç†çš„æ­£ç¡®ç»“æœã€‚<strong>ä½œç”¨</strong>ï¼šä¸ºpromiseå®ä¾‹æ·»åŠ çŠ¶æ€æ”¹å˜æ—¶çš„å›è°ƒå‡½æ•°</li></ul> <ul><li>**p.catch()ï¼š**å‡ºç°å¼‚å¸¸ä¼šè°ƒç”¨çš„å‡½æ•°</li> <li>**p.finally()ï¼š**ä¸ç®¡æ˜¯æˆåŠŸè¿˜æ˜¯å¤±è´¥éƒ½ä¼šè§¦å‘</li> <li><strong>Promise.all()</strong>  å¹¶å‘å¤„ç†å¤šä¸ªå¼‚æ­¥ä»»åŠ¡ï¼Œæ‰€æœ‰ä»»åŠ¡éƒ½æˆåŠŸæ‰è¿”å›æˆåŠŸçš„ç»“æœï¼Œæœ‰ä¸€ä¸ªå‡ºé”™å°±è¿”å›é”™è¯¯çš„ç»“æœ</li> <li><strong>Promise.race()</strong>  å¹¶å‘å¤„ç†å¤šä¸ªå¼‚æ­¥ä»»åŠ¡ï¼Œæœ‰ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œå®Œå°±å¾—åˆ°ç»“æœ</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// Promise.all()è¿™ä¸ªæ–¹æ³•å¯ä»¥æ¥æ”¶ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„é‡Œé¢çš„æ¯ä¸€é¡¹å°±æ˜¯æ¯ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡çš„promiseå®ä¾‹å¯¹è±¡;æ‰€æœ‰ä»»åŠ¡éƒ½æ‰§è¡Œå®Œæ‰å¾—åˆ°ç»“æœã€‚**Promise.allè·å¾—çš„æˆåŠŸç»“æœçš„æ•°ç»„é‡Œé¢çš„æ•°æ®é¡ºåºå’ŒPromise.allæ¥æ”¶åˆ°çš„æ•°ç»„é¡ºåºæ˜¯ä¸€è‡´çš„**ã€‚å¯ä»¥å®ç°**å¹¶è¡Œ**æ‰§è¡Œã€‚</span>
Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>p1<span class="token punctuation">,</span>p2<span class="token punctuation">,</span>p3<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//è¿™ä¸ªthenå‡½æ•°ä¼šç­‰æ‰€æœ‰çš„ä»»åŠ¡å®Œæˆæ‰ä¼šè§¦å‘ï¼Œæœ€ç»ˆresultçš„ç»“æœä¹Ÿæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„é‡Œé¢å°±å¾—åˆ°äº†æ¯ä¸€ä¸ªä»»åŠ¡çš„ç»“æœ</span>
<span class="token comment">// promise.allçš„ç¼ºé™·ï¼šåªè¦æœ‰ä¸€ä¸ªå¤±è´¥ï¼Œå°±ä¼šè¿”å›å¤±è´¥</span>
<span class="token comment">// promise.allåªè¿”å›ä¸€ä¸ªpromiseï¼Œæ‰€ä»¥å½“é‡åˆ°ç¬¬ä¸€ä¸ªrejectedçš„promiseæ—¶ï¼Œå°±ä¼šç«‹å³è¿”å›rejectedï¼Œå…¶ä»–fullfilledçš„promiseå³ä½¿æ‰§è¡Œäº†ä¹Ÿä¸ä¼šè¿”å›ã€‚</span>
<span class="token comment">// è§£å†³åŠæ³•ï¼š</span>
<span class="token comment">// asyncAction4()ä¸ºå¤±è´¥çš„æ“ä½œï¼Œ1,2,3ä¸ºæ­£å¸¸çš„</span>
promiseArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token function">asyncAction1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">asyncAction2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">asyncAction3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">asyncAction4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// éå†å¼‚æ­¥æ“ä½œæ•°ç»„ï¼Œåˆ©ç”¨catchæ•è·é”™è¯¯ï¼Œå¹¶return errå‡ºå»ã€‚å½“catchæ•è·rejectedä¿¡æ¯åï¼Œpromiseçš„é“¾æ¡å°±æ¢å¤äº†ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨catchä¸­å°†é”™è¯¯ä¿¡æ¯è¿›è¡Œè¿”å›ï¼Œé‚£ä¹ˆä¸‹ä¸€æ­¥thenè¿”å›çš„promiseå°†ä¼šæˆä¸ºfufilledçŠ¶æ€,é”™è¯¯ä¿¡æ¯å°†æˆä¸ºresolveå›è°ƒå‡½æ•°çš„å‚æ•°ã€‚</span>
Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>promiseArr<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">p</span> <span class="token operator">=&gt;</span> p<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> err<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// async1,async2,async3</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// err4</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p><strong>promiseæºç åˆ†æ:</strong></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// é¦–å…ˆnew Promiseæ—¶ï¼Œä¼ ç»™promiseçš„å‡½æ•°å‘é€å¼‚æ­¥è¯·æ±‚ï¼Œæ¥ç€è°ƒç”¨promiseå¯¹è±¡çš„thenå±æ€§ï¼Œæ³¨å†Œè¯·æ±‚æˆåŠŸçš„å›è°ƒå‡½æ•°ï¼Œç„¶åå½“å¼‚æ­¥è¯·æ±‚å‘é€æˆåŠŸæ—¶ï¼Œè°ƒç”¨resolve(results.id)æ–¹æ³•, è¯¥æ–¹æ³•æ‰§è¡Œthenæ–¹æ³•æ³¨å†Œçš„å›è°ƒæ•°ç»„ã€‚</span>
<span class="token keyword">function</span> <span class="token function">Promise</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// fn(exector)æ‰§è¡Œå™¨</span>
  <span class="token keyword">let</span> self <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token string">'pending'</span><span class="token punctuation">;</span> <span class="token comment">// è®¾ç½®çŠ¶æ€</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span> <span class="token comment">// æˆåŠŸçš„å€¼</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>reason <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span> <span class="token comment">// å¤±è´¥çš„å€¼</span>
  <span class="token comment">// å­˜æ”¾æˆåŠŸå›è°ƒçš„æ•°ç»„</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>onResolveCallbacks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token comment">// å­˜æ”¾å¤±è´¥å›è°ƒçš„æ•°ç»„</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>onRejectedCallbacks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// æˆåŠŸæ‰§è¡Œ</span>
  <span class="token keyword">function</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// è°ƒç”¨resolveæ–¹æ³•ï¼Œå°±æ˜¯æ‰§è¡Œthenä¸­çš„å›è°ƒ</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token string">'pending'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      self<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token string">'fulfilled'</span><span class="token punctuation">;</span>
        <span class="token comment">// ä¿å­˜æˆåŠŸæ•°æ®</span>
      self<span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>
        <span class="token comment">// æˆåŠŸåéå†thenä¸­æˆåŠŸçš„æ‰€æœ‰å›è°ƒå‡½æ•°</span>
      self<span class="token punctuation">.</span>onResolveCallbacks<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">callback</span> <span class="token operator">=&gt;</span> <span class="token function">callback</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> 
    <span class="token comment">// å¤±è´¥æ‰§è¡Œ</span>
  <span class="token keyword">function</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token parameter">reason</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token string">'pending'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      self<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token string">'rejected'</span><span class="token punctuation">;</span>
     <span class="token comment">// ä¿å­˜å¤±è´¥æ•°æ®</span>
      self<span class="token punctuation">.</span>reason <span class="token operator">=</span> reason<span class="token punctuation">;</span>
      <span class="token comment">// å¤±è´¥åéå†thenä¸­å¤±è´¥çš„æ‰€æœ‰å›è°ƒå‡½æ•°</span>
      self<span class="token punctuation">.</span>onRejectCallbacks<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">callback</span> <span class="token operator">=&gt;</span> <span class="token function">callback</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> 
  <span class="token keyword">try</span><span class="token punctuation">{</span>
    <span class="token function">fn</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// then</span>
<span class="token class-name">Promise</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>then <span class="token operator">=</span> <span class="token function">funtion</span><span class="token punctuation">(</span><span class="token parameter">onFulfilled<span class="token punctuation">,</span>onRejected</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> self <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token string">'resolved'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">onFulfulled</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token string">'rejected'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">onRejected</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// å¦‚æœå¼‚æ­¥æ‰§è¡Œåˆ™ä½pendingçŠ¶æ€</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token string">'pending'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ä¿å­˜å›è°ƒå‡½æ•°ï¼› å°†thenä¸­çš„å‚æ•°å‡½æ•°ä¿å­˜èµ·æ¥</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>onResolvedCallbacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">onFulfilled</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span>onRejectedCallbacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">onRejected</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>reason<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// å®ç°é“¾å¼è°ƒç”¨</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span>
<span class="token punctuation">}</span>

<span class="token comment">// è¿™é‡Œæˆ‘ä»¬å¯ä»¥å†æ¬¡å®éªŒ</span>
<span class="token keyword">let</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0.5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'æˆåŠŸ'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'å¤±è´¥'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'success'</span> <span class="token operator">+</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'err'</span> <span class="token operator">+</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// å®ç°promise.finally()</span>
<span class="token class-name">Promise</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">finally</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> <span class="token constant">P</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>constructor<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
    <span class="token parameter">value</span>  <span class="token operator">=&gt;</span> <span class="token constant">P</span><span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> value<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token constant">P</span><span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token keyword">throw</span> reason <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br></div></div><p><strong>promise.then()çš„ç¬¬äºŒä¸ªå‚æ•°å’Œcatchçš„åŒºåˆ«ï¼š</strong></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 1.Promise å¯¹è±¡çš„é”™è¯¯å…·æœ‰â€œå†’æ³¡â€æ€§è´¨ï¼Œä¼šä¸€ç›´å‘åä¼ é€’ï¼Œç›´åˆ°è¢«æ•è·ä¸ºæ­¢ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œé”™è¯¯æ€»æ˜¯ä¼šè¢«ä¸‹ä¸€ä¸ªcatchè¯­å¥æ•è·ã€‚</span>
<span class="token function">getJSON</span><span class="token punctuation">(</span><span class="token string">'/post/1.json'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">post</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">getJSON</span><span class="token punctuation">(</span>post<span class="token punctuation">.</span>commentURL<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">comments</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// some code</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// å¤„ç†å‰é¢ä¸‰ä¸ªPromiseäº§ç”Ÿçš„é”™è¯¯</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ä¸Šé¢ä»£ç ä¸­ï¼Œä¸€å…±æœ‰ä¸‰ä¸ª Promise å¯¹è±¡ï¼šä¸€ä¸ªç”±getJSONäº§ç”Ÿï¼Œä¸¤ä¸ªç”±thenäº§ç”Ÿã€‚å®ƒä»¬ä¹‹ä¸­ä»»ä½•ä¸€ä¸ªæŠ›å‡ºçš„é”™è¯¯ï¼Œéƒ½ä¼šè¢«æœ€åä¸€ä¸ªcatchæ•è·ã€‚è¿™ä¹Ÿæ˜¯thençš„ç¬¬äºŒä¸ªå‚æ•°å¤„ç†ä¸äº†çš„ã€‚</span>
<span class="token comment">// ä¸»è¦åŒºåˆ«ï¼šthençš„ç¬¬ä¸€ä¸ªå›è°ƒå‡ºé”™ï¼Œç¬¬äºŒä¸ªå›è°ƒæ˜¯æ•è·ä¸åˆ°çš„ã€‚ä½†catchå¯ä»¥æ•è·åˆ°</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><strong>å®ç°ä¸€ä¸ªpromise.all</strong></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">promiseAll</span><span class="token punctuation">(</span><span class="token parameter">promises</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//   all()è¿”å›çš„æ˜¯promiseå®ä¾‹å¯¹è±¡</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  	 <span class="token comment">// åˆ¤æ–­ promisesæ˜¯å¦ä¸ºæ•°ç»„</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isArray</span><span class="token punctuation">(</span>promises<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token string">'arguments must be an array'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// è®°å½•promisesä¸­çš„å¯¹è±¡resolveçš„ä¸ªæ•°</span>
    <span class="token keyword">var</span> resolvedCounter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token comment">// promiseå®ä¾‹å¯¹è±¡çš„ä¸ªæ•°</span>
    <span class="token keyword">var</span> promiseNum <span class="token operator">=</span> promises<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
    <span class="token comment">// å­˜å‚¨ç»“æœ</span>
    <span class="token keyword">var</span> resolvedValues <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span>promiseNum<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// å¯¹æ•°ç»„ä¸­çš„å®ä¾‹å¯¹è±¡è¿›è¡Œè°ƒç”¨</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> promiseNum<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// è‡ªæ‰§è¡Œå‡½æ•°</span>
      <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">i</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>promises<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          resolvedCounter<span class="token operator">++</span>
          resolvedValues<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> value
          <span class="token keyword">if</span> <span class="token punctuation">(</span>resolvedCounter <span class="token operator">==</span> promiseNum<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token function">resolve</span><span class="token punctuation">(</span>resolvedValues<span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">reason</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token function">reject</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p><span id="ge"><strong>promise, generator,async/await:</strong></span><br> <strong>å…³ç³»</strong>ï¼šPromiseæ˜¯åŸºç¡€ï¼ŒGeneratorå’Œasync/awaitä¸²è¿å¤šä¸ªPromiseçš„åŒæ­¥æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯æŠŠPromiseçš„å¼‚æ­¥ç‰¹æ€§å˜ä¸ºåŒæ­¥ï¼Œç¼–ç¨‹æ›´çˆ½ã€‚async/awaitæ˜¯Generatorçš„è¯­æ³•ç³–ï¼Œå°±æ˜¯å°†<strong>generator+è‡ªåŠ¨æ‰§è¡Œå™¨</strong>å°è£…åˆ°ä¸€èµ·å®ç°ã€‚</p> <h5 id="generatorï¼ˆç”Ÿæˆå™¨ï¼‰ï¼šå¯ä»¥å®ç°ç¨‹åºçš„æš‚åœå’Œå¤šæ¬¡è¿”å›"><a href="#generatorï¼ˆç”Ÿæˆå™¨ï¼‰ï¼šå¯ä»¥å®ç°ç¨‹åºçš„æš‚åœå’Œå¤šæ¬¡è¿”å›" aria-hidden="true" class="header-anchor">#</a> <strong>Generator</strong>ï¼ˆç”Ÿæˆå™¨ï¼‰ï¼šå¯ä»¥å®ç°ç¨‹åºçš„æš‚åœå’Œå¤šæ¬¡è¿”å›</h5> <ul><li>ç”Ÿæˆå™¨æ˜¯ä¸€ç§ç±»åç¨‹æˆ–åŠåç¨‹ï¼Œå®ƒæä¾›äº†ä¸€ç§å¯ä»¥é€šè¿‡<strong>ç‰¹å®šè¯­å¥æˆ–æ–¹æ³•ä½¿å…¶æ‰§è¡Œå¯¹è±¡æš‚åœ</strong>çš„åŠŸèƒ½ã€‚
Generatorå‡½æ•°ï¼Œè¿”å›ä¸€ä¸ªéƒ¨ç½²äº†Iteratoræ¥å£çš„éå†å™¨å¯¹è±¡ï¼Œç”¨æ¥æ“ä½œå†…éƒ¨æŒ‡é’ˆã€‚ä»¥åï¼Œæ¯æ¬¡è°ƒç”¨éå†å™¨å¯¹è±¡çš„nextæ–¹æ³•ï¼Œå°±ä¼šè¿”å›ä¸€ä¸ªæœ‰ç€valueå’Œdoneä¸¤ä¸ªå±æ€§çš„å¯¹è±¡ã€‚valueå±æ€§è¡¨ç¤ºå½“å‰çš„å†…éƒ¨çŠ¶æ€çš„å€¼ï¼Œæ˜¯yieldè¯­å¥åé¢é‚£ä¸ªè¡¨è¾¾å¼çš„å€¼ï¼›doneå±æ€§æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ˜¯å¦éå†ç»“æŸã€‚</li> <li><strong>åç¨‹</strong>(coroutine)ï¼Œæ„æ€æ˜¯<strong>å¤šä¸ªçº¿ç¨‹ç›¸äº’åä½œï¼Œå®Œæˆå¼‚æ­¥ä»»åŠ¡</strong>ã€‚æ‰§è¡Œæµç¨‹ï¼šåç¨‹Aå¼€å§‹æ‰§è¡Œï¼Œåç¨‹Aæ‰§è¡Œåˆ°ä¸€åŠï¼Œæš‚åœæ‰§è¡Œï¼Œæ‰§è¡Œçš„æƒåˆ©è½¬äº¤ç»™åç¨‹Bï¼Œä¸€æ®µæ—¶é—´åBäº¤è¿˜æ‰§è¡Œæƒï¼Œåç¨‹Aé‡å¾—æ‰§è¡Œæƒï¼Œç»§ç»­æ‰§è¡Œã€‚</li> <li>Generatoræ˜¯åç¨‹åœ¨ES6çš„å®ç°ï¼Œæœ€å¤§çš„ç‰¹ç‚¹å°±æ˜¯å¯ä»¥äº¤å‡ºå‡½æ•°çš„æ‰§è¡Œæƒï¼Œæ‡‚å¾—é€€è®©.</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">gen</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> y <span class="token operator">=</span> <span class="token keyword">yield</span> x <span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">var</span> g <span class="token operator">=</span> <span class="token function">gen</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// gæ˜¯Generatorå‡½æ•°çš„å®ä¾‹ã€‚å®ƒå…·æœ‰çŠ¶æ€å€¼suspendedå’Œclosedï¼Œsuspendedä»£è¡¨æš‚åœï¼Œclosedåˆ™ä¸ºç»“æŸã€‚</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> g<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// { value: 3, done: false }</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> g<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// { value: undefined, done: true }</span>

<span class="token comment">//å‡½æ•°å¤šäº†*å·ï¼Œç”¨æ¥è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªGeneratorå‡½æ•°ï¼Œå’Œæ™®é€šå‡½æ•°ä¸ä¸€æ ·ï¼Œ</span>
<span class="token comment">//è¿”å›çš„æ˜¯æŒ‡é’ˆå¯¹è±¡gï¼Œè¿™ä¸ªæŒ‡é’ˆgæœ‰ä¸ªnextæ–¹æ³•ï¼Œè°ƒç”¨å®ƒä¼šè¿”å›yieldåæ‰§è¡Œçš„å†…å®¹.</span>
<span class="token comment">//å¯¹è±¡ä¸­æœ‰ä¸¤ä¸ªå€¼ï¼Œvalueå’Œdoneï¼Œvalue å±æ€§æ˜¯ yield è¯­å¥åé¢è¡¨è¾¾å¼çš„å€¼ï¼Œè¡¨ç¤ºå½“å‰é˜¶æ®µçš„å€¼ï¼Œdoneè¡¨ç¤ºæ˜¯å¦Generatorå‡½æ•°æ˜¯å¦æ‰§è¡Œå®Œæ¯•ã€‚</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><strong>Genaratorçš„ä½¿ç”¨ï¼š</strong></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// é¦–å…ˆå£°æ˜ä¸€ä¸ªç”Ÿæˆå™¨å‡½æ•°</span>
<span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'starting *main()'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">yield</span><span class="token punctuation">;</span> <span class="token comment">// æ‰“ä½ï¼Œä¸è®¸å¾€ä¸‹èµ°äº†</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'continue yield 1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">yield</span><span class="token punctuation">;</span> <span class="token comment">// æ‰“ä½ï¼Œåˆä¸è®¸å¾€ä¸‹èµ°äº†</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'continue yield 2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// æ„é€ å‡ºä¸€ä¸ªè¿­ä»£å™¨it</span>
<span class="token keyword">let</span> it <span class="token operator">=</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

<span class="token comment">// è°ƒç”¨next()å¯åŠ¨*mainç”Ÿæˆå™¨ï¼Œè¡¨ç¤ºä»å½“å‰ä½ç½®å¼€å§‹è¿è¡Œï¼Œåœåœ¨ä¸‹ä¸€ä¸ªyieldå¤„</span>
it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è¾“å‡º starting *main()</span>

<span class="token comment">// ç»§ç»­å¾€ä¸‹èµ°</span>
it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è¾“å‡º continue yield 1</span>

<span class="token comment">// å†ç»§ç»­å¾€ä¸‹èµ°</span>
it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è¾“å‡º continue yield 2</span>
<span class="token comment">//----------------------------</span>
<span class="token comment">/*
å› ä¸ºlet it = main(); è¿›è¡Œå®ä¾‹åŒ–ä¹‹åï¼Œmain()é‡Œçš„ä»£ç ä¸ä¼šä¸»åŠ¨æ‰§è¡Œã€‚ç¬¬ä¸€ä¸ªnext()æ°¸è¿œæ˜¯ç”¨äºå¯åŠ¨ç”Ÿæˆå™¨ï¼Œç”Ÿæˆå™¨å¯åŠ¨åè¦æƒ³è¿è¡Œåˆ°æœ€åï¼Œå…¶å†…éƒ¨çš„æ¯ä¸ªyieldéƒ½ä¼šå¯¹åº”ä¸€ä¸ªnext()ï¼Œæ‰€ä»¥è¯´next()æ°¸è¿œéƒ½ä¼šæ¯”yieldå¤šä¸€ä¸ªäº†
yieldç›¸å½“äºå½•éŸ³æœºçš„æš‚åœé”®
nextç›¸å½“äºå½•éŸ³æœºçš„ç»§ç»­é”®
next()å¯æ¥å—å‚æ•°ï¼Œä¼ å…¥çš„å‚æ•°æŠŠä¸Šä¸€ä¸ªyieldè¯­å¥çš„è¿”å›å€¼ç»™è¦†ç›–äº†ã€‚é€šè¿‡Nextæ–¹æ³•å¯ä»¥åˆ†é˜¶æ®µçš„æ³¨å…¥æ•°æ®
*/</span>
<span class="token comment">//---------------------------------------</span>
<span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">fun</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> n<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> v <span class="token operator">=</span> <span class="token keyword">yield</span> n <span class="token operator">+</span> <span class="token number">22</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'aa--:'</span> <span class="token operator">+</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">yield</span> <span class="token operator">++</span>n<span class="token punctuation">;</span>
    <span class="token keyword">yield</span> <span class="token operator">++</span>n
<span class="token punctuation">}</span>
<span class="token keyword">var</span> it <span class="token operator">=</span> <span class="token function">fun</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// {value:23, done:false}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// aa--:undefined {value:2, done:false}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//{value:3, done:false}</span>
<span class="token comment">/*
- é€šè¿‡**yield**è¯­å¥å¯ä»¥åœ¨ç”Ÿæˆå™¨å‡½æ•°å†…éƒ¨æš‚åœä»£ç çš„æ‰§è¡Œä½¿å…¶æŒ‚èµ·ï¼Œæ­¤æ—¶ç”Ÿæˆå™¨å‡½æ•°ä»ç„¶æ˜¯è¿è¡Œå¹¶ä¸”æ˜¯æ´»è·ƒçš„ï¼Œå…¶å†…éƒ¨èµ„æºéƒ½ä¼šä¿ç•™ä¸‹æ¥ï¼Œåªä¸è¿‡æ˜¯å¤„åœ¨æš‚åœçŠ¶æ€ã€‚
- åœ¨è¿­ä»£å™¨ä¸Šè°ƒç”¨**next()**æ–¹æ³•å¯ä»¥ä½¿ä»£ç ä»æš‚åœçš„ä½ç½®å¼€å§‹ç»§ç»­å¾€ä¸‹æ‰§è¡Œã€‚
- è™½ç„¶Generatorå°†å¼‚æ­¥æ“ä½œè¡¨ç¤ºå¾—å¾ˆç®€æ´ï¼Œä½†æ˜¯ç®¡ç†éº»çƒ¦ï¼Œä½•æ—¶æ‰§è¡Œç¬¬ä¸€é˜¶æ®µï¼Œåˆä½•æ—¶æ‰§è¡Œç¬¬äºŒé˜¶æ®µï¼Ÿ--- æ˜¯çš„ï¼Œè¿™æ—¶å€™åˆ°Async/awaitå‡ºç°äº†
*/</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><p><strong>Generatorå’Œè‡ªåŠ¨æ‰§è¡Œå™¨å®ç°async/await</strong>:</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// å®šä¹‰äº†ä¸€ä¸ªpromiseï¼Œç”¨æ¥æ¨¡æ‹Ÿå¼‚æ­¥è¯·æ±‚ï¼Œä½œç”¨æ˜¯ä¼ å…¥å‚æ•°++</span>
<span class="token keyword">function</span> <span class="token function">getNum</span><span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span>num<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">//è‡ªåŠ¨æ‰§è¡Œå™¨ï¼Œå¦‚æœä¸€ä¸ªGeneratorå‡½æ•°æ²¡æœ‰æ‰§è¡Œå®Œï¼Œåˆ™é€’å½’è°ƒç”¨</span>
<span class="token keyword">function</span> <span class="token function">asyncFun</span><span class="token punctuation">(</span><span class="token parameter">func</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">var</span> gen <span class="token operator">=</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">function</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> result <span class="token operator">=</span> gen<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>done<span class="token punctuation">)</span> <span class="token keyword">return</span> result<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
    result<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token function">next</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// æ‰€éœ€è¦æ‰§è¡Œçš„Generatorå‡½æ•°ï¼Œå†…éƒ¨çš„æ•°æ®åœ¨æ‰§è¡Œå®Œæˆä¸€æ­¥çš„promiseä¹‹åï¼Œå†è°ƒç”¨ä¸‹ä¸€æ­¥</span>
<span class="token keyword">var</span> <span class="token function-variable function">func</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">var</span> f1 <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">getNum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> f2 <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">getNum</span><span class="token punctuation">(</span>f1<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>f2<span class="token punctuation">)</span> <span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">asyncFun</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/chunyanhuang/vuepress-blog/edit/master/interview/one/notes/promise.md" target="_blank" rel="noopener noreferrer">Edit</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">11/12/2019, 8:14:48 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/vuepress-blog/interview/one/notes/åŸå‹.html" class="prev">åŸå‹</a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/vuepress-blog/assets/js/app.428408aa.js" defer></script><script src="/vuepress-blog/assets/js/2.5f74fd52.js" defer></script><script src="/vuepress-blog/assets/js/16.76c0197a.js" defer></script>
  </body>
</html>
